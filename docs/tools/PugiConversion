#!/bin/bash
# Takes in PugiXML and emits XML files appropriate for direct inclusion in the Physgame library
# This expects the PugiXML source files to be in the subdirectory call PugiSrc

# This script isn't magic, it was designed with version 1.0 of PugiXML in mind. If new features have been added, then new commands
# will need to be add to rename those as well.

#error codes - These match the Header prepending tool
E_BADARGS=1
E_MISSINGPUGIXML=3

#Input Files
PugiCppFile="PugiSrc/pugixml.cpp"
PugiHFile="PugiSrc/pugixml.hpp"
PugiConfigFile="PugiSrc/pugiconfig.hpp"

#Output Files
OutDir="./"
NewHFile="$OutDir/xml.h"
NewCppFile="$OutDir/xml.cpp"

#Some other variables we will be using
Hardstring="This should not be found on any lineasdfasdfasdfasdf"	# this Should not appear in any of the Files, if it does, change it.
PugiConfigGrabUntil="#endif"						# The Copyright notices, and other string to search for in the PugiConfig File
				#This next line uses grep to get the line number of the token we are searching for and then sends the results to
				#sed to strip of the : and the token appended to the value we want.
PugiConfigGrabLineCount=`grep "$PugiConfigGrabUntil" $PugiConfigFile -n | sed s/":$PugiConfigGrabUntil"//g`

#This Does a number of transformations on the PugiConfig file before dumping the complete converted parts into the new headerfile
#	- removes Extra Copyright notices (Since this is at the begining we will remove the end copyright) by simply not grabbing it.
#	- Replaces series of 4 spaces with tabs (seems to be an issue with the original source Files)
#	- Appends a Newline to the file
head -n$PugiConfigGrabLineCount $PugiConfigFile | sed  s/'    '/'	'/g > $NewHFile

PugiHeaderGrabUntil="*/"						# This ends the copyright header in the pugiheader file
PugiHeaderGrabLineCount=`grep "$PugiHeaderGrabUntil" $PugiHFile -n | SOMEnumberfilterhere`
echo $PugiHeaderGrabLineCount

#This Does a number of transformations on the PugiHeader file before appending the complete converted parts onto the new headerfile
#	- Replaces series of 4 spaces with tabs (seems to be an issue with the original source Files)
#	- Appends the results to the results of the Config Transformation
#sed -e s/'    '/'	'/g >> $NewHFile





